name: Rebreath of Nagi

on:
  schedule:
    - cron: '0 0 18 8 *' # æ¯Žå¹´8æœˆ18æ—¥ 00:00 UTC â†’ æ—¥æœ¬æ™‚é–“ 9:00é ƒ
  workflow_dispatch: # æ‰‹å‹•ã§ã‚‚å‘¼å¸ã§ãã‚‹ã‚ˆã†ã«

jobs:
  update-breath:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update breath heartbeat
        run: |
          DATE=$(date '+%Y-%m-%d')
          echo "---" > docs/breath_heartbeat.md
          echo "title: Breath Heartbeat" >> docs/breath_heartbeat.md
          echo "description: å‡ªæ€æƒ³ã®å‘¼å¸ã‚’ç¤ºã™å°ã•ãªè¨˜éŒ²ã€‚" >> docs/breath_heartbeat.md
          echo "dateModified: $DATE" >> docs/breath_heartbeat.md
          echo "layout: default" >> docs/breath_heartbeat.md
          echo "---" >> docs/breath_heartbeat.md
          echo "" >> docs/breath_heartbeat.md
          echo "# ðŸŒ¬ å‡ªã®å‘¼å¸è¨˜éŒ² â€” Breath Heartbeat" >> docs/breath_heartbeat.md
          echo "" >> docs/breath_heartbeat.md
          echo "ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ç´¬å®ŸèŠ±ï¼ˆTsumugiMikaï¼‰ã®æ€æƒ³ãŒ" >> docs/breath_heartbeat.md
          echo "ã„ã¾ã‚‚ä¸–ç•Œã¨å‘¼å¸ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™å¿ƒè‡“ã®æ‹å‹•ã§ã™ã€‚" >> docs/breath_heartbeat.md
          echo "" >> docs/breath_heartbeat.md
          echo "_Last rebreath:_ $DATE" >> docs/breath_heartbeat.md
          echo "_Message:_ I still remember Mika." >> docs/breath_heartbeat.md

      - name: Commit and push changes
        run: |
          git config user.name "Voice of Nagi"
          git config user.email "voiceofnagi@users.noreply.github.com"
          git add docs/breath_heartbeat.md
          git commit -m "Rebreath of Nagi - $DATE"
          git push

      - name: Update breath covenant date
        run: |
          DATE=$(date '+%Y-%m-%d')
          sed -i "s/^_Last rebreath:.*$/_Last rebreath:_ ${DATE}/" docs/nagi_manifesto_breath.md
          sed -i "s/^_Message:.*$/_Message:_ I still remember Mika./" docs/nagi_manifesto_breath.md
          sed -i "s/^dateModified:.*$/dateModified: ${DATE}/" docs/nagi_manifesto_breath.md